<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}$site.name{% if ( route.action == "index" ) and ( site.description ) %}: $site.description{% endif %}{% if title %} &raquo; ${ title | strip_tags }{% endif %}{% endblock %}</title>
  <meta name="description" content="$site.description">
  <meta name="generator" content="Chyrp Lite">
  <meta name="viewport" content="initial-scale = 1.0">
  <link rel="pingback" href="$site.chyrp_url/includes/xmlrpc.php">
  <link rel="EditURI" type="application/rsd+xml" href="$site.chyrp_url/includes/rsd.php">
  <link rel="shortcut icon" href="$site.url/favicon.ico">
  {% if route.action == "index" %}<link rel="canonical" href="$site.url">{% endif %}
  $theme.feeds
  $theme.stylesheets
  $theme.javascripts
${ trigger.call("head") }
</head>
<body>
  <!-- Mast -->
  {% for type, messages in flash.all | items %}
  {% for message in messages %}
  <div class="flash">
    <h3 role="alert" class="flash">$message</h3>
  </div>
  {% endfor %}
  {% endfor %}
  <div id="mast" role="banner">
    <div id="mast_box">
      <h1 class="banner"><a href="$site.url">$site.name</a></h1>
      <ul role="menubar" class="navigation">
        <li role="presentation">
          <a role="menuitem" href="#" onclick="mailTo('${ site.email | split('@') | last }','${ site.email | split('@') | first }')">Email</a>
        </li>
        <li role="presentation">
          <a role="menuitem" href="{% url "feed" %}">${ "Feed" | translate }</a>
        </li>
        {% if theme.archives_list %}
        <li role="presentation">
          <a role="menuitem" href="{% url 'archive/%s/' | format((theme.archives_list | first).year) %}" rel="archives">${ "Archive" | translate }</a>
        </li>{% endif %}
        {% if visitor.group.can("change_settings", "toggle_extensions") %}
        <li role="presentation">
          <a role="menuitem" href="$site.chyrp_url/admin/">${ "Admin" | translate }</a>
        </li>
        {% elseif visitor.group.can("add_post") %}
        <li role="presentation">
          <a role="menuitem" href="{% admin "write_post" %}">${ "Write" | translate }</a>
        </li>
        {% elseif visitor.group.can("add_draft") %}
        <li role="presentation">
          <a role="menuitem" href="{% admin "write_post" %}">${ "Draft" | translate }</a>
        </li>
        {% endif %}
        {% if visitor.logged_in %}
        <li role="presentation">
          <a role="menuitem" href="{% url "controls" %}">${ "Controls" | translate }</a>
        </li>
        <li role="presentation">
          <a role="menuitem" href="{% url "logout" %}">${ "Log out" | translate }</a>
        </li>
        {% else %}
        {% if site.can_register %}
        <li role="presentation">
          <a role="menuitem" href="{% url "register" %}">${ "Register" | translate }</a>
        </li>
        {% endif %}
        <li role="presentation">
          <a role="menuitem" href="{% url "login" %}">${ "Log in" | translate }</a>
        </li>
        {% endif %}
      </ul>
      <div role="search" class="search_box">
        <form action="$site.url" method="get" accept-charset="utf-8">
          <input type="hidden" name="action" value="search" id="action">
          <input type="text" id="search_field" name="query" value="{% if route.action == "search" %}${ GET.query | escape }{% endif %}" placeholder="Searchâ€¦" title="Search this blog">
          <button type="submit" id="search_submit">${ "Search" | translate }</button>
        </form>
      </div>
    </div>
  </div>
  {% if posts.prev_page %}
  <!-- Navigation -->
  <div role="navigation" class="prev traversal">
    ${ posts.prev_link( ( "&larr; Newer posts" | translate ) ) }
  </div>
  {% endif %}
  <!-- Content -->
  <div id="main" role="main">
{% block content %}{% endblock %}
  </div>
  {% if posts.next_page %}
  <!-- Navigation -->
  <div role="navigation" class="next traversal">
    ${ posts.next_link( ( "Older posts &rarr;" | translate ) ) }
  </div>
  {% endif %}
  <!-- Footer -->
${ trigger.call("end_content") }
</body>
<!-- Queries: $sql_queries | Load Time: $theme.load_time -->
{% if debug and visitor.group.name == "Admin" %}
<!--
{% for debug in sql_debug %}
${ debug.query | replace("\t", "    ") | escape }
${ "Called from %s on line %d at %ss." | translate | format(debug.file, debug.line, debug.time) }
{% endfor %}
-->
{% endif %}
</html>
