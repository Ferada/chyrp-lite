  <div id="sidebar" role="navigation">
    <h1 class="banner"><a href="$site.url">$site.name</a></h1>
    <div role="search" class="search_box">
      <form action="$site.url" method="get" accept-charset="utf-8">
        <input type="hidden" name="action" value="search" id="action">
        <input type="text" id="sidebar_search_field" name="query" value="{% if route.action == "search" %}${ GET.query | escape }{% endif %}" placeholder="${ "Search&hellip;" | translate }" title="${ "Search this blog" | translate }">
        <button type="submit" id="sidebar_search_submit">${ "Search" | translate }</button>
      </form>
    </div>
    {% if visitor.logged_in %}
    <h4>${ "Hello, %s!" | translate | format(visitor.full_name | split(" ") | first | fallback(visitor.login)) }</h4>
    {% endif %}
    <ul role="menu" class="navigation sidebar_nav" aria-label="${ "Links" | translate }">
      {% if route.action != "index" %}
      <li role="presentation">
        <a role="menuitem" href="{% url "index" %}" rel="">${ "Blog" | translate }</a>
      </li>
      {% endif %}
      <li role="presentation">
        <a role="menuitem" href="#" onclick="mailTo('${ site.email | split('@') | last }','${ site.email | split('@') | first }')">${ "Email" | translate }</a>
      </li>
      <li role="presentation">
        <a role="menuitem" href="{% url "feed" %}" rel="alternate">${ "Feed" | translate }</a>
      </li>
      {% if visitor.group.can("change_settings", "toggle_extensions") %}
      <li role="presentation">
        <a role="menuitem" href="$site.chyrp_url/admin/">${ "Admin" | translate }</a>
      </li>
      {% elseif visitor.group.can("add_post") %}
      <li role="presentation">
        <a role="menuitem" href="{% admin "write_post" %}">${ "Write" | translate }</a>
      </li>
      {% elseif visitor.group.can("add_draft") %}
      <li role="presentation">
        <a role="menuitem" href="{% admin "write_post" %}">${ "Draft" | translate }</a>
      </li>
      {% endif %}
      {% if visitor.logged_in %}
      <li role="presentation">
        <a role="menuitem" href="{% url "controls" %}">${ "Controls" | translate }</a>
      </li>
      <li role="presentation">
        <a role="menuitem" href="{% url "logout" %}">${ "Log out" | translate }</a>
      </li>
      {% else %}
      {% if site.can_register %}
      <li role="presentation">
        <a role="menuitem" href="{% url "register" %}">${ "Register" | translate }</a>
      </li>
      {% endif %}
      <li role="presentation">
        <a role="menuitem" href="{% url "login" %}">${ "Log in" | translate }</a>
      </li>
      {% endif %}
    </ul>
${ trigger.call("sidebar") }
    {% if categorize %}
    <h4 id="label_categories">${ "Categories" | translate }</h4>
    <ul role="menu" class="navigation sidebar_nav categories" aria-labelledby="label_categories">
    {% for cat in categorize %}
      {% if cat.show_on_home %}
      <li role="presentation">
        <a role="menuitem" href="${ cat.url }">${ cat.name }</a>
      </li>
      {% endif %}
    {% endfor %}
    </ul>
    {% endif %}
    {% if theme.pages_list %}
    <h4 id="label_my_pages">${ "Pages" | translate }</h4>
    <ul role="menu" class="navigation sidebar_nav my_pages" aria-labelledby="label_my_pages">
      {% for item in theme.pages_list %}
      <li role="presentation" class="page depth$item.page.depth{% if item.has_children %} parent{% endif %}">
        <a role="menuitem" href="$item.page.url">$item.page.title</a>
      </li>
      {% endfor %}
    </ul>
    {% endif %}
    {% if ( route.action == "view" ) and theme.related_posts(post) %}
    <h4 id="label_related_posts">${ "Related Posts" | translate }</h4>
    <ul role="menu" class="navigation sidebar_nav related_posts" aria-labelledby="label_related_posts">
    {% for post in theme.related_posts(post) %}
      {% if post.title %}
      <li role="presentation">
        <a role="menuitem" href="$post.url">${ post.title | normalize | truncate(30) }</a>
      </li>
      {% endif %}
    {% endfor %}
    </ul>
    {% elseif theme.recent_posts %}
    <h4 id="label_recent_posts">${ "Recent Posts" | translate }</h4>
    <ul role="menu" class="navigation sidebar_nav recent_posts" aria-labelledby="label_recent_posts">
    {% for post in theme.recent_posts %}
      {% if post.title %}
      <li role="presentation">
        <a role="menuitem" href="$post.url">${ post.title | normalize | truncate(30) }</a>
      </li>
      {% endif %}
    {% endfor %}
    </ul>
    {% endif %}
    {% if theme.archives_list %}
    <h4 id="label_archive_list">
      <a href="{% url 'archive/%s/' | format((theme.archives_list | first).year) %}" rel="archives">${ "Archive" | translate }</a>
    </h4>
    <ul role="menu" class="navigation sidebar_nav archive_list" aria-labelledby="label_archive_list">
      {% for archive in theme.archives_list %}
      <li role="presentation">
        <a role="menuitem" href="$archive.url">${ archive.when | strftime("%B %Y" | translate) }</a>
      </li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>