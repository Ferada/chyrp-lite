{% extends "layouts/default.twig" %}

{% block content %}
  {% if archives %} {# List? (For all/yearly archives) #}
    {% if ( GET.year != null ) and ( timestamp.year > (archives | first).year ) %}
    <div role="navigation" class="prev traversal">
        <a href="{% url 'archive/%s/' | format(((archives | first).year) + 1) %}">${ "Archive of %s" | translate | format(((archives | first).year) + 1 ) }</a>
    </div>
    {% endif %}
    <div class="archive standalone">
    {% for archive in archives %}
      <h3 id="label_${ archive.timestamp }_archive" class="archive"><a href="$archive.url">${ archive.timestamp | strftime("%B %Y" | translate) }</a></h3>
      <ul aria-labelledby="label_${ archive.timestamp }_archive" class="archive{% if GET.year != null %} yearly{% endif %}">
        {% for post in archive.posts %}
        <li>
          {% if GET.year != null %} {# Yearly archive: display thumbnails #}
          <article class="post $post.feather" id="post_$post.id">
            <a href="$post.url">
            {% if post.title %}
              <h4 class="yearly">${ post.title | normalize | truncate(20) }</h4>
            {% else %}
              <h4 class="yearly">${ post.created_at | strftime("%d %b, %Y" | translate) }</h4>
            {% endif %}
            </a>
            {% if post.feather == "photo" %}
            ${ feathers['photo'].image_link(post, 320, null, "quality=60") }
            {% else %}
            <p>${ post.excerpt | read_more("â€¦more") }</p>
            {% endif %}
          </article>
          {% else %} {# Complete archive: display titles to minimise content payload #}
          <a href="$post.url">
          {% if post.title %}
            <h4>${ post.title | normalize | truncate(80) }</h4>
          {% else %}
            <h4>${ post.created_at | strftime("%d %b, %Y" | translate) }</h4>
          {% endif %}
          </a>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
      <hr>
    {% endfor %}
    </div>
    {% if GET.year != null %}
    <div role="navigation" class="next traversal">
        <a href="{% url 'archive/%s/' | format(((archives | first).year) - 1) %}">${ "Archive of %s" | translate | format(((archives | first).year) - 1 ) }</a>
    </div>
    {% endif %}
  {% endif %}

  {% if posts.paginated %} {# Posts? (For daily/monthly archives) #}
    {% if archive.depth == "day" %}
    <div class="ribbon">
      <h3 role="status" class="ribbon">${ "Archive of %s" | translate | format(archive.timestamp | strftime("%d %B, %Y" | translate)) }</h3>
    </div>
    {% endif %}
    {% if archive.depth == "month" %}
    <div class="ribbon">
      <h3 role="status" class="ribbon">${ "Archive of %s" | translate | format(archive.timestamp | strftime("%B %Y" | translate)) }</h3>
    </div>
    {% endif %}
    {% for post in posts.paginated %}
    {% include "feathers/" ~ post.feather ~ ".twig" %}
    {% endfor %}
  {% endif %}

  {% if not archives and not posts.paginated %} {# No results #}
    <div class="ribbon">
      <h3 role="status" class="ribbon">${ "There aren't any posts in the timeframe you specified" | translate }</h3>
    </div>
  {% endif %}
{% endblock %}
